<nav class="navbar navbar-light bg-light">
    <div style="height: 100%;width: 40px;display: inline;float: left;">
    </div>
    <span class="navbar-brand mb-0 h1">Organization Chart
        <i class="bi bi-filter-left"></i>
    </span>
    <div class="btn-toolbar ml-auto mr-auto" role="toolbar" aria-label="Toolbar with button groups">
        <div class="btn-group mr-2" role="group" aria-label="Second group">
            <button type="button" class="btn btn-outline-dark btn-sm" (click)="saveSheet(sheetSelected)" ngbTooltip="Save Sheet" [disabled]="!sheetSelected.ID">
                <i class="bi bi-save"></i>
            </button>
            <button type="button" class="btn btn-outline-dark btn-sm" ngbTooltip="Search Sheet" (click)="openSheetSearch($event,searchSheetTemplate)">
                <i class="bi bi-folder2-open"></i>
            </button>
            <button type="button" class="btn btn-outline-dark btn-sm" (click)="openSheetForm($event,sheetTemplate,null)" ngbTooltip="Add Sheet">
                <i class="bi bi-plus-circle"></i>
            </button>
            <!-- <ng-template #popTitle>Delete <b>{{sheetSelected.SheetName}}</b>?</ng-template>
            <ng-template #popContent>
                <button class="btn btn-sm btn-outline-danger " (click)="deleteCurrentSheet()">Yes</button>
                <button class="btn btn-sm btn-outline-success">No</button>
            </ng-template>
            <button (click)="confirmDelete(p1)" triggers="manual" #p1="ngbPopover" placement="bottom" [ngbPopover]="popContent" [popoverTitle]="popTitle" type="button" class="btn btn-outline-dark btn-sm">
                <span ngbTooltip="Delete Sheet">
                    <i class="bi bi-dash-circle"></i>
                </span>
            </button> -->

            <button ngbTooltip="Delete Sheet" (click)="openConfirmDeleteAny($event,confirmDeleteAnyTemplate,sheetSelected.SheetName,deleteCurrentSheet,null)"  type="button" class="btn btn-outline-dark btn-sm">
                <i class="bi bi-dash-circle"></i>
            </button>


            <button type="button" class="btn btn-outline-dark btn-sm" (click)="openSheetFormEdit($event,sheetTemplate,sheetSelected)" ngbTooltip="Edit Sheet">
                <i class="bi bi-pen"></i>
            </button>
            <button type="button" class="btn btn-sm btn-outline-dark" (click)="openReporsWindow($event,reportsWindowTemplate)" ngbTooltip="Reports">
                <i class="bi bi-list"></i>
            </button>
            <div class="btn-group-sm mr-1" role="group" aria-label="First group">
                <div class="input-group" style="position: relative;">
                    <input id="filter" #filter style="margin-top: 5px; height: 20px;width: 80px" class="form-control" type="text" placeholder="" [(ngModel)]="textSearch2" (keyup)="paperView.getCellsByText(textSearch2)" />
                    <button class="btn" id="btn-filter-graph">
                        <span *ngIf="textSearch2.length>0" aria-hidden="true" (click)="filter.value='';paperView.unhighlightAll();textSearch2=''">&times;</span>
                    </button>
                    <i *ngIf="textSearch2.length<=0" style="position: absolute;right: 1px;top:8px" class="bi bi-search"></i>
                </div>
            </div>
            <button style="padding-right: 0px" type="button" class="btn btn-sm btn-outline-dark" ngbTooltip="focus Previous Node" (click)="paperView.getPreviousCellByCurrentSearch()">
                <i class="bi bi-chevron-left"></i>
            </button>
            <button style="padding-left: 0px" type="button" class="btn btn-sm btn-outline-dark" (click)="paperView.getNextCellByCurrentSearch()" ngbTooltip="focus Next Node">
                <i class="bi bi-chevron-right"></i>
            </button>
            <div class="btn-group-sm mr-1" role="group" aria-label="First group" style="height: 26px">
                <input id="nodeGraphLevelSelected" name="nodeGraphLevelSelected" style="margin-top: 5px; height: 20px;width: 50px; display: inline;float: left;padding-right: 0px;" class="form-control" min="0" type="number" [(ngModel)]="nodeGraphLevelSelected" (keyup)="showNodesByLevel(nodeGraphLevelSelected)" (change)="showNodesByLevel(nodeGraphLevelSelected)" />
                <!--                     <div class="input-group" style="position: relative;">
                    </div> -->
            </div>
            <button type="button" class="btn btn-sm btn-outline-dark" (click)="contractAllSheetNodes()" ngbTooltip="Collapse All">
                <i class="bi bi-arrows-angle-contract"></i>
            </button>
            <button type="button" class="btn btn-sm btn-outline-dark" (click)="expandAllSheetNodes()" ngbTooltip="Expand All">
                <i class="bi bi-arrows-angle-expand"></i>
            </button>
            <div class="btn-group" ngbDropdown role="group" aria-label="Button group with nested dropdown" ngbTooltip="Scale">
                <button class="btn btn-outline-dark btn-sm" ngbTooltip="Scale" ngbDropdownToggle>
                    <i class="bi bi-zoom-in"></i>
                    ({{paperView.scale}})</button>
                <div class="dropdown-menu" ngbDropdownMenu>
                    <button ngbDropdownItem (click)="paperView.setScale(0.3)">0.3</button>
                    <button ngbDropdownItem (click)="paperView.setScale(0.5)">0.5</button>
                    <button ngbDropdownItem (click)="paperView.setScale(0.7)">0.7</button>
                    <button ngbDropdownItem (click)="paperView.setScale(1)">1</button>
                </div>
            </div>
            <button type="button" class="btn btn-outline-dark btn-sm" (click)="openTranslateAllModal($event,translateAllTemplate)" ngbTooltip="Move All">
                <i class="bi bi-arrows-move"></i>
            </button>
            <!-- <button type="button" class="btn btn-outline-dark btn-sm" (click)="addRootNode()" ngbTooltip="Add Graph Node">
                    <i class="bi bi-node-plus"></i>
                </button> -->
            <button type="button" class="btn btn-outline-dark btn-sm" (click)="clearGraphAndSheet()" ngbTooltip="Clear Graph">
                <i class="bi bi-x-circle"></i>
            </button>
            <button type="button" class="btn btn-outline-dark btn-sm" ngbTooltip="Default config" (click)="openConfigDefaultShapeModal($event,configDefaultShapeTemplate)">
                <i class="bi bi-gear"></i>
            </button>
            <button type="button" class="btn btn-sm btn-outline-dark" ngbTooltip="Graph from Element" (click)="generateGraph(treeOrg)">
                    <i class="bi bi-diagram-2"></i>
            </button>
            <button type="button" class="btn btn-outline-dark btn-sm" (click)="exportG()" ngbTooltip="Export">
                <i class="bi bi-download"></i>
            </button>
            <button *ngIf="panelExpanded==false" type="button" class="btn btn-outline-dark btn-sm" (click)="panelExpanded=true" ngbTooltip="Hide right panel">
                <i class="bi bi-arrow-bar-right"></i>
            </button>
            <button *ngIf="panelExpanded==true" type="button" class="btn btn-outline-dark btn-sm" (click)="panelExpanded=false" ngbTooltip="showright panel">
                <i class="bi bi-arrow-bar-left"></i>
            </button>
        </div>
    </div>
    <span id="user-info">
        <div ngbDropdown class="d-inline-block">
            <button style=" border: none; " class="btn btn-outline-primary" id="dropdownBasic2" ngbDropdownToggle>
                <span class="mr-2">
                    <i class="bi bi-grid"></i>
                </span>
                <span class="mr-2 user-name">{{userName}}</span>
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#45d9d9" class="bi bi-person-circle" viewBox="0 0 16 16">
                        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                        <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
                    </svg>
                    <!--                 <img  class="rounded-circle" src="assets/images/nick.png"> -->
                </span>
            </button>
            <div ngbDropdownMenu aria-labelledby="dropdownBasic2">
                <button style="padding: .25rem 6rem;" ngbDropdownItem (click)="logout()">logout</button>
            </div>
        </div>
    </span>
</nav>
<div class="container-fluid">
    <div class="row">
        <div class="col-3">
            <div style="height: 100%;width: 40px;display: inline;float: left;">
            </div>
            <ngb-accordion #accordion activeIds="3" id="ngb-accordion1" (panelChange)="onAccordionChange($event)">
                <ngb-panel id="1">
                    <ng-template ngbPanelTitle style="position: relative;">

                        <span *ngIf="!panelsIds[1]" style="position: absolute;top:10px;right: 10px">
                            <i class="bi bi-caret-right-fill" style="color:#343a40"></i>
                        </span>
                        <span *ngIf="panelsIds[1]" style="position: absolute;top:10px;right: 10px">
                            <i class="bi bi-caret-down-fill" style="color:#343a40"></i>
                        </span>
                        <span class="panel-title">Shapes</span>
    
                        <i class="bi bi-circle-square" 
                                        style="position: absolute;left: -40px;
                                                top: 10px; color: rgb(69, 217, 217);
                                                font-size: 24px; 
                                                border-right: 4px solid #45d9d9;
                                                padding: 3px 15px 5px 5px;
                                                background-color: rgba(224, 247, 250, 0.35);" ></i>

                    </ng-template>
                    <ng-template ngbPanelContent>
                        <div id="position-data">
                            <div class="row">
                                <div class="col-3">
                                    <div class="row">
                                        <div class="col-12" [cdkDragData]="{positionType:'position',sheetSelected:sheetSelected,treeOrg:treeOrg}" (cdkDragEnded)="paperView.drop($event)" cdkDrag>
                                            <img style="width:80%;" src="assets/images/position.png">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="row">
                                        <div class="col-12" [cdkDragData]="{positionType:'external',sheetSelected:sheetSelected,treeOrg:treeOrg}" cdkDrag (cdkDragEnded)="paperView.drop($event)">
                                            <img style="width:80%" src="assets/images/external.png">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="row">
                                        <div class="col-12" [cdkDragData]="{positionType:'vacant',sheetSelected:sheetSelected,treeOrg:treeOrg}" (cdkDragEnded)="paperView.drop($event)" cdkDrag>
                                            <img style="width:80%" src="assets/images/vacant.png">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="row">
                                        <div class="col-12" [cdkDragData]="{positionType:'temporal',sheetSelected:sheetSelected,treeOrg:treeOrg}" (cdkDragEnded)="paperView.drop($event)" cdkDrag>
                                            <img style="width:80%" src="assets/images/temporal.png">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4">
                                <div class="col-3">
                                    <div class="row">
                                        <div class="col-12" ngbTooltip="Functional Relationship">
                                            <img style="width:100%" src="assets/images/functionalrel.png">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="row">
                                        <div class="col-12" ngbTooltip="Direct Relationship">
                                            <img style="width:100%" src="assets/images/directrel.png">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="row">
                                        <div class="col-12" [cdkDragData]="{positionType:'advisor',sheetSelected:sheetSelected,treeOrg:treeOrg}" (cdkDragEnded)="paperView.drop($event)" cdkDrag>
                                            <img style="width:80%" src="assets/images/advisor.png">
                                        </div>
                                        <!-- 
                                        <div class="col-12" style="margin-top: 5px;" ngbTooltip="Advisor">
                                            <img style="width:100%;" src="assets/images/advisor.png">
                                        </div>
 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </ngb-panel>
                <ngb-panel id="2">
                    <ng-template ngbPanelTitle style="position: relative;">
                        <span *ngIf="!panelsIds[2]" style="position: absolute;top:10px;right: 10px">
                            <i class="bi bi-caret-right-fill" style="color:#343a40"></i>
                        </span>
                        <span *ngIf="panelsIds[2]" style="position: absolute;top:10px;right: 10px">
                            <i class="bi bi-caret-down-fill" style="color:#343a40"></i>
                        </span>
                        <span class="panel-title">Organization Chart</span>
                        <i class="bi bi-triangle" style="position: absolute;left: -40px;top: 10px; color: rgb(69, 217, 217); font-size: 24px;border-right: 4px solid #45d9d9;padding: 3px 15px 5px 5px;background-color: rgba(224, 247, 250, 0.35);" ></i>


                    </ng-template>
                    <ng-template ngbPanelContent>
                        <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
                            <div class="input-group" style="position: relative;">
                                <input #treenodesearchinput id="filter" #filter style="height: 26px;width: 60px" class="form-control" type="text" placeholder="" [(ngModel)]="textSearch" (keyup)="findTreeNodeByName(tree,filter.value) " />
                                <button class="btn" id="btn-filter-graph">
                                    <span *ngIf="textSearch.length>0" aria-hidden="true" (click)="filter.value='';findTreeNodeByName(tree,'');textSearch=''">&times;</span>
                                </button>
                                <i class="bi bi-search" style="position: absolute;right: 1px;top:5px"></i>
                            </div>
                            <button style="padding-right:  0px" type="button" class="btn btn-sm btn-outline-dark" ngbTooltip="focus Previous Node">
                                <i class="bi bi-chevron-left" (click)="treeFocusPreviousNode()"></i>
                            </button>
                            <button style="padding-left: 0px" type="button" class="btn btn-sm btn-outline-dark" (click)="treeFocusNextNode()" ngbTooltip="focus Next Node">
                                <i class="bi bi-chevron-right"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-dark" (click)="openConfirmDeleteTreeNode
($event,confirmDeleteTreeNodeTemplate,tree)" ngbTooltip="Delete Node">
                                <i class="bi bi-dash-circle"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-dark" (click)="openAddTreeNodeTemplate($event,addTreeNodeTemplate,tree)" ngbTooltip="Add Child Node">
                                <i class="bi bi-plus-circle"></i>
                            </button>
                            <div class="input-group" style="width: 60px;height: 15px">
                                <input id="filterlevel" #treefilterlevel type="number" min="0" style="height: 26px;padding-right: 0px" class="form-control" aria-label="Input group example" aria-describedby="btnGroupAddon" [(ngModel)]="treeLevelFilter" (keyup)="setTreeLevelFilter(tree,treefilterlevel.value)" (change)="setTreeLevelFilter(tree,treefilterlevel.value)">
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-dark" (click)="tree.treeModel.collapseAll()" ngbTooltip="Collapse All">
                                <i class="bi bi-arrows-angle-contract"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-dark" (click)="tree.treeModel.expandAll()" ngbTooltip="Expand All">
                                <i class="bi bi-arrows-angle-expand"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-dark" (click)="removeNodeDisplacement(tree)" ngbTooltip="Remove  Displacement">
                                <i class="bi bi-arrow-left"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-dark" (click)="addNodeDisplacement(tree)" ngbTooltip="Insert Displacement">
                                <i class="bi bi-arrow-right"></i>
                            </button>
<!--                             <button type="button" class="btn btn-sm btn-outline-dark" ngbTooltip="Graph from Element" (click)="generateGraph(tree)">
                                <i class="bi bi-diagram-2"></i>
                            </button> -->
                            <button type="button" class="btn btn-sm btn-outline-dark" ngbTooltip="Export Tree Nodes" (click)="exportTreeNodes(tree)">
                                <i class="bi bi-download"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-dark" (click)="openReporsWindow($event,reportsWindowTemplate)" ngbTooltip="Reports">
                                <i class="bi bi-list"></i>
                            </button>
                        </div>
                        <div style="height: 230px;overflow: auto;">
                            <tree-root #tree [nodes]="nodes" (focus)="onNodeFocus($event,tree)" (updateData)="onUpdateTree($event,tree)" [options]="options" (event)="onTreeEvent($event)"></tree-root>
                        </div>
                    </ng-template>
                </ngb-panel>
                <ngb-panel id="3">
                    <ng-template ngbPanelTitle style="position: relative;">
                        <span *ngIf="!panelsIds[3]" style="position: absolute;top:10px;right: 10px">
                            <i class="bi bi-caret-right-fill" style="color: #343a40"></i>
                        </span>
                        <span *ngIf="panelsIds[3]" style="position: absolute;top:10px;right: 10px">
                            <i class="bi bi-caret-down-fill" style="color: #343a40"></i>
                        </span>
                        <span class="panel-title">Projects</span>
                        <i class="bi bi-journals" style="position: absolute;left: -40px;top: 10px; color: rgb(69, 217, 217); font-size: 24px;border-right: 4px solid #45d9d9;padding: 3px 15px 5px 5px;background-color: rgba(224, 247, 250, 0.35);" ></i>
                    </ng-template>
                    <ng-template ngbPanelContent>
                        <button class="btn btn-outline-dark mb-1" (click)="openProjectForm($event,projectTemplate,null)" ngbTooltip="Add Project">
                            <i class="bi bi-plus-circle"></i>
                        </button>
                        <table class="table table-sm">
                            <tbody>
                                <tr *ngFor="let project of projects; index as i">
                                    <td style="width: 50%;overflow-x: hidden;">
                                        {{ project.ProjectName }}
                                    </td>
                                    <td style="width: 50%;">
                                        


                                        <div class="btn-group-sm" style="text-align: right;" role="group" aria-label="First group">



                                            <button type="button" class="btn btn-outline-dark btn-sm" (click)="openProjectForm($event,projectTemplate,project)" ngbTooltip="Edit Project">
                                                <i class="bi bi-pen"></i>
                                            </button>
                                           <!-- <ng-template #popTitle>Delete <b>{{project.ProjectName}}</b>?</ng-template>
                                            <ng-template #popContent>
                                                <button class="btn btn-sm btn-outline-danger " (click)="deleteProject(project)">Yes</button>
                                                <button class="btn btn-sm btn-outline-success">No</button>
                                            </ng-template>
                                             <button (click)="confirmDeleteProject(p2)" triggers="manual" #p2="ngbPopover" placement="top" [ngbPopover]="popContent" [popoverTitle]="popTitle" type="button" class="btn btn-outline-dark btn-sm">
                                                <i class="bi bi-dash-circle"></i>
                                            </button> -->
                                            <button (click)="openConfirmDeleteAny($event,confirmDeleteAnyTemplate,project.ProjectName,deleteProject,project)"  type="button" class="btn btn-outline-dark btn-sm">
                                                <i class="bi bi-dash-circle"></i>
                                            </button>
                                           


                                            <button type="button" class="btn btn-outline-dark btn-sm" (click)="loadProject(project)" ngbTooltip="Select Project">
                                                <i class="bi bi-check2-all"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </ng-template>
                </ngb-panel>

               <ngb-panel id="4">
                    <ng-template ngbPanelTitle style="position: relative;">
                        <span *ngIf="!panelsIds[3]" style="position: absolute;top:10px;right: 10px">
                            <i class="bi bi-caret-right-fill" style="color: #343a40"></i>
                        </span>
                        <span *ngIf="panelsIds[3]" style="position: absolute;top:10px;right: 10px">
                            <i class="bi bi-caret-down-fill" style="color: #343a40"></i>
                        </span>

                        <span class="panel-title"></span>
                        <i class="bi bi-people" style="position: absolute;left: -40px;top: 10px; color: rgb(69, 217, 217); font-size: 24px;border-right: 4px solid #45d9d9;padding: 3px 15px 5px 5px;background-color: rgba(224, 247, 250, 0.35);" ></i>
                    </ng-template>
                    <ng-template ngbPanelContent>
                    </ng-template>
                </ngb-panel>
        
            </ngb-accordion>
        </div>
        <div id="sheetContainer" [ngClass]="panelExpanded?'col-9':'col-6'" [ngStyle]="{'background-color': (sheets.length>0?'rgba(224, 247, 250, 0.35)': '#ffffff') }" style="overflow: scroll;">
            <ul ngbNav [(activeId)]="activeId" #nav="ngbNav" class=" nav nav-pills nav-fill nav-tabs" (navChange)="onNavChange($event)">
                <li ngbNavItem class="nav-item" [ngbNavItem]="sheet.ID" *ngFor="let sheet of sheets">
                    <button type="button" class="close" aria-label="Close" style="outline: none;color: #45d9d9" (click)="removeSheetFromView(sheet)">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <a ngbNavLink class="nav-link">{{sheet.SheetName}}</a>
                    <ng-template ngbNavContent>
                    </ng-template>
                </li>
            </ul>
            <div [ngbNavOutlet]="nav"></div>
            <app-joint #paperView (clickGraphNodeEvent)="graphNodeSelected($event)" (refreshSelectedSheetEvent)="refreshSelectedSheetAfterDelete($event)" (sheetDimentionsChangeEvent)="setSheetNewSize($event)" (graphNodeAddedEvent)="graphNodeAdded($event)" (nodeGraphNameChangeEvent)="nodeGraphNameChange($event)">
            </app-joint>
            <div style="position: fixed; bottom: 1%;left: 25%">
                <ul class="list-unstyled">
                    <li style="margin-bottom: 2px"><span class="badge" style="color: #ffffff;background-color: #3cd039;border-radius: 50%">0</span> Supervised Positions</li>
                    <li style="margin-bottom: 2px"><span class="badge" style="color: #ffffff;background-color: #ee9f06;border-radius:50% ">0</span> Directly Supervised Positions</li>
                    <li style="margin-bottom: 2px"><span class="badge" style="color: #ffffff;background-color: #3977d4;border-radius:50% ">0</span> Position Advisors</li>
                </ul>
            </div>
        </div>
        <div [ngClass]="panelExpanded?'hidePanel':'col-3'" style="border: 1px solid #efefef">
            <form>
                <div class="form-row">
                    <div class="col">
                        <input type="text" class="form-control mt-1" id="PositionNameInput" name="PositionNameInput" placeholder="Position Name" #PositionName="ngModel" [(ngModel)]="positionCurrent.PositionName" (change)="saveNamePosition(positionCurrent,tree)">
                    </div>
                    <div class="col">
                        <input type="text" class="form-control mt-1" id="PositionCodeInput" name="PositionCodeInput" placeholder="Position Code" #PositionCode="ngModel" [(ngModel)]="positionCurrent.PositionCode" (change)="savePosition(positionCurrent,tree)">
                    </div>
                </div>
                <div class="form-row">
                    <div class="col" style="position: relative;">
                        <input type="text" class="form-control mt-1" id="PositionInmediateSuperiorInput" name="PositionInmediateSuperiorInput" placeholder="Inmediate Superior" #PositionInmediateSuperior="ngModel" [(ngModel)]="positionCurrent.PositionInmediateSuperior" (change)="savePosition(positionCurrent,tree)" disabled>
                        <i (click)="openSetImendiateSuperior($event,setImendiateSuperiorTemplate)" style="position: absolute;right: 8px;top:18px;" class="bi bi-search"></i>
                    </div>
                    <div class="col">
                        <div class="form-check mt-1" id="advising-input-wrap">
                            <input class="form-check-input" type="checkbox" id="AdvisingAuthorityCodeInput" name="AdvisingAuthorityCodeInput" #AdvisingAuthority="ngModel" [(ngModel)]="positionCurrent.AdvisingAuthority" (change)="changeAdvisingAuthorityPosition(positionCurrent,tree)">
                            <label id="advising-input-label" class="form-check-label" for="AdvisingAuthorityCodeInput">
                                Advising Authority
                            </label>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="col">
                        <input type="text" class="form-control mt-1" id="LocationInput" name="LocationInput" placeholder="Location" #Location="ngModel" [(ngModel)]="positionCurrent.Location" (change)="savePosition(positionCurrent,tree)">
                    </div>
                    <div class="col">
                        <input type="text" class="form-control mt-1" id="AbbreviationInput" name="AbbreviationInput" placeholder="Abbreviation" #Abbreviation="ngModel" [(ngModel)]="positionCurrent.Abbreviation" (change)="savePosition(positionCurrent,tree)">
                    </div>
                </div>
                <div class="form-row">
                    <div class="col">
                        <input type="text" class="form-control mt-1" id="CompanyInput" name="CompanyInput" placeholder="Company" #Company="ngModel" [(ngModel)]="positionCurrent.Company" (change)="savePosition(positionCurrent,tree)">
                    </div>
                    <div class="col">
                        <!--                         <input type="text" class="form-control mt-1" id="DedicationRegimeInput" name="DedicationRegimeInput" placeholder="Dedication Regime" #DedicationRegime="ngModel" [(ngModel)]="positionCurrent.DedicationRegime" (change)="savePosition(positionCurrent,tree)"> -->
 
                       <div class="row mt-1">
                     <!--                            <label for="nodeType" class="col-6 col-form-label radio-shapes" style="padding-right:5px;">Dedication Regime</label> -->
                            <div class="col-12"> 
                                <select (change)="changeDedicationRegime(positionCurrent,tree);" class="form-control" [(ngModel)]="positionCurrent.DedicationRegime" name="textBox.DedicationRegime">
                                    <option [ngValue]="'position'">Full</option>
                                    <option [ngValue]="'temporal'">Temporal</option>
                                </select>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="form-row">
                    <div class="col">
                        <input class="form-control mt-1" placeholder="yyyy-mm-dd" name="CreationDate" type="date" #CreationDate="ngModel" [(ngModel)]="positionCurrent.CreationDate" (change)="savePosition(positionCurrent,tree)">
                    </div>
                    <div class="col">
                        <input type="number" class="form-control mt-1" id="SpacesToSupervisorInput" name="SpacesToSupervisorInput" #SpacesToSupervisor="ngModel" min="0" [(ngModel)]="positionCurrent.SpacesToSupervisor" (change)="savePositionDisplacement(positionCurrent,tree)">
                    </div>
                </div>
                <div class="d-flex" id="position-data" style="background-color: #ffffff">
                    <ul ngbNav #nav3="ngbNav" [(activeId)]="activeDetail" class="nav-pills" orientation="vertical" (navChange)="onNavChangeNav3($event)">
                        <li [ngbNavItem]="1">
                            <a ngbNavLink><span class="tab-title-small">Mission</span></a>
                            <ng-template ngbNavContent>
                                <textarea style="height: 100%" rows="8" class="form-control" id="PositionValues" name="PositionValues" placeholder="Mission" #PositionValues="ngModel" [(ngModel)]="positionCurrent.PositionValues" (change)="savePosition(positionCurrent,tree)"></textarea>
                            </ng-template>
                        </li>
                        <li [ngbNavItem]="2">
                            <a ngbNavLink>
                                <span class="tab-title-small">Position Description</span></a>
                            <ng-template ngbNavContent>
                                <textarea style="height: 100%" rows="8" class="form-control col-12" id="PositionObjective" name="PositionObjective" placeholder="Position Description" #PositionObjective="ngModel" [(ngModel)]="positionCurrent.PositionObjective" (change)="savePosition(positionCurrent,tree)"></textarea>
                            </ng-template>
                        </li>
                        <li [ngbNavItem]="3">
                            <a ngbNavLink><span class="tab-title-small">Position Employee</span></a>
                            <ng-template ngbNavContent>
                                <div class="row">
                                    <div class="col-12">
                                        <app-select-contact #selectContactComp (contactsAdded)="addNewContactsEmployeePosition($event)"></app-select-contact>
                                    </div>
                                    <table class="table table-sm">
                                        <tbody>
                                            <tr *ngFor="let person of treeNodeCurrent.data.employees_position">
                                                <td>
                                                    <button class="btn" (click)="deleteContactsEmployeePosition(person)">
                                                        <i class="bi bi-x-circle"></i>
                                                    </button>
                                                </td>
                                                <td> {{person.name}} </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </ng-template>
                        </li>
                        <li [ngbNavItem]="4">
                            <a ngbNavLink><span class="tab-title-small">Functional Relationship</span></a>
                            <ng-template ngbNavContent>
                                <button type="button" class="btn btn-outline-dark btn-sm" (click)="openAddFunctionalRel($event,funcionalRelTemplate)" ngbTooltip="Add Functional Relationship">
                                    <i class="bi bi-plus-circle"></i>
                                </button>
                                <table>
                                    <tbody>
                                        <tr *ngFor="let functionalRel of treeNodeCurrent.data.functionalrels">
                                            <td>
                                                <button class="btn" (click)="deleteFunctionalRel(functionalRel,tree)">
                                                    <i class="bi bi-x-circle"></i>
                                                </button>
                                            </td>
                                            <td> {{functionalRel.name}} </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </ng-template>
                        </li>
                        <li [ngbNavItem]="5">
                            <a ngbNavLink><span class="tab-title-small">Notes</span></a>
                            <ng-template ngbNavContent>
                                <textarea style="height: 100%" rows="8" class="form-control" id="Notes" name="Notes" placeholder="Notes" #Notes="ngModel" [(ngModel)]="positionCurrent.Notes" (change)="savePosition(positionCurrent,tree)"></textarea>
                            </ng-template>
                        </li>
                        <li [ngbNavItem]="6">
                            <a ngbNavLink><span class="tab-title-small">Attachments</span></a>
                            <ng-template ngbNavContent>
                                <button type="button" class="btn btn-outline-dark btn-sm" (click)="openFileUpload($event,uploadTemplate)" ngbTooltip="Add Attachment">
                                    <i class="bi bi-plus-circle"></i>
                                </button>
                                <table>
                                    <tbody>
                                        <tr *ngFor="let attachment of treeNodeCurrent.data.attachments; index as i">
                                            <td>

                                                <ng-template #popTitle>Delete?</ng-template>
                                                <ng-template #popContent>
                                                <button class="btn btn-sm btn-outline-danger " (click)="    deleteAttachment(attachment,tree)">Yes</button>
                                                                <button class="btn btn-sm btn-outline-success">No</button>
                                                </ng-template>
                                                    <button (click)="confirmDelete(p1)" triggers="manual" #p1="ngbPopover" placement="bottom" [ngbPopover]="popContent" [popoverTitle]="popTitle" type="button" class="btn btn-outline-dark btn-sm">
                                                                    <i class="bi bi-x-circle"></i>
                                                   </button>
<!--                                                 <button class="btn" (click)="deleteAttachment(attachment,tree)">
                                                    <i class="bi bi-x-circle"></i>
                                                </button> -->
                                            </td>
                                            <td> {{fileNameSub(attachment.name)}} </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </ng-template>
                        </li>
                        <li [ngbNavItem]="7">
                            <a ngbNavLink><span class="tab-title-small">Privacy</span></a>
                            <ng-template ngbNavContent>
                                <div class="row">
                                    <div class="col-12" style="min-height: 140px">
                                        <div class="row">
                                            <div class="col-12">
                                                <form style="margin-bottom: 0px;height: 15px;">
                                                    <label class="form-control" for="enableAditional" style="border:none">
                                                        <input type="checkbox" name="enableAditional" [(ngModel)]="treeNodeCurrent.data.privacy.enableAditional" (change)="savePosition2();">
                                                        <small style="margin-left: 10px;">Aditional</small>
                                                    </label>
                                                </form>
                                            </div>
                                            <div class="col-12">
                                                <app-select-contact *ngIf="treeNodeCurrent.data.privacy.enableAditional" #selectContactComp (contactsAdded)="addAditionalPosition($event)"></app-select-contact>
                                            </div>
                                        </div>
                                        <table class="table table-sm" *ngIf="treeNodeCurrent.data.privacy.enableAditional" style="margin-bottom: 0px;">
                                            <tbody>
                                                <tr>
                                                    <th> </th>
                                                    <th> <small>Name</small> </th>
                                                    <th> <small>See</small> </th>
                                                    <th> <small>Modify</small> </th>
                                                    <th> <small>Delete</small> </th>
                                                </tr>
                                                <tr *ngFor="let contact of treeNodeCurrent.data.privacy.contactsAditional">
                                                    <td>
                                                        <button class="btn" (click)="deleteAditionalPosition(contact,tree)">
                                                            <i class="bi bi-x-circle"></i>
                                                        </button>
                                                    </td>
                                                    <td> {{contact.name}} </td>
                                                    <td class="pt-2"><input (change)="updateAditionalPosition(contact)" type="checkbox" name="{{contact.see}}" [(ngModel)]="contact.see">
                                                    </td>
                                                    <td class="pt-2"><input (change)="updateAditionalPosition(contact)" type="checkbox" name="{{contact.modify}}" [(ngModel)]="contact.modify">
                                                    </td>
                                                    <td class="pt-2"> <input (change)="updateAditionalPosition(contact)" type="checkbox" name="{{contact.delete}}" [(ngModel)]="contact.delete"> </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="col-12" style="min-height: 140px">
                                        <div class="row">
                                            <div class="col-12">
                                                <form style="margin-bottom: 0px;height: 15px;">
                                                    <label class="form-control" for="enableException" style="border:none">
                                                        <input type="checkbox" name="enableException" [(ngModel)]="treeNodeCurrent.data.privacy.enableException" (change)="savePosition(positionCurrent,treeOrg);">
                                                        <small style="margin-left: 10px;">Exception</small>
                                                    </label>
                                                </form>
                                            </div>
                                            <div class="col-12">
                                                <app-select-contact *ngIf="treeNodeCurrent.data.privacy.enableException" #selectContactComp (contactsAdded)="addExceptionPosition($event)"></app-select-contact>
                                                <!-- 
                                                    <input *ngIf="positionCurrentPrivacy.enableAditional" class="form-control form-control-sm" type="text" name="enableAditionalSearch" placeholder="Search" [ngbTypeahead]="searchContacts" [resultTemplate]="rt" (selectItem)="selectAditionalPosition($event)" [inputFormatter]="formatter"> -->
                                            </div>
                                        </div>
                                        <table *ngIf="treeNodeCurrent.data.privacy.enableException" class="table table-sm" style="margin-bottom: 0px;">
                                            <tbody>
                                                <tr>
                                                    <th></th>
                                                    <th> <small>Name</small> </th>
                                                    <th> <small>See</small> </th>
                                                    <th> <small>Modify</small> </th>
                                                    <th> <small>Delete</small> </th>
                                                </tr>
                                                <tr *ngFor="let contact of treeNodeCurrent.data.privacy.contactsException">
                                                    <td> <button class="btn" (click)="deleteExceptionPosition(contact,tree)">
                                                            <i class="bi bi-x-circle"></i>
                                                        </button>
                                                    </td>
                                                    <td> {{contact.name}} </td>
                                                    <td class="pt-2"><input (change)="updateExceptionPosition(contact)" type="checkbox" name="{{contact.see}}" [(ngModel)]="contact.see"> </td>
                                                    <td class="pt-2"><input (change)="updateExceptionPosition(contact)" type="checkbox" name="{{contact.modify}}" [(ngModel)]="contact.modify"></td>
                                                    <td class="pt-2"> <input (change)="updateExceptionPosition(contact)" type="checkbox" name="{{contact.delete}}" [(ngModel)]="contact.delete"> </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </ng-template>
                        </li>
                    </ul>
                    <div [ngbNavOutlet]="nav3" class="ml-2" style="width: 100%"></div>
                </div>
                <div id="position-data">
                    <div class="row">
                        <div class="col-6">
                            <div class="row">
                                <div class="col-5">
                                    <img style="width:100%" src="assets/images/position.png">
                                </div>
                                <div class="col-7">
                                    <span class="text-info">Position</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="row">
                                <div class="col-5">
                                    <img style="width:100%" src="assets/images/external.png">
                                </div>
                                <div class="col-7">
                                    <span class="text-info">External Position</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-6">
                            <div class="row">
                                <div class="col-5">
                                    <img style="width:100%" src="assets/images/vacant.png">
                                </div>
                                <div class="col-7">
                                    <span class="text-info">Vacant Position</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="row">
                                <div class="col-5">
                                    <img style="width:100%" src="assets/images/temporal.png">
                                </div>
                                <div class="col-7">
                                    <span class="text-info">Temporal Position</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-6">
                            <div class="row">
                                <div class="col-5">
                                    <img style="width:100%" src="assets/images/functionalrel.png">
                                </div>
                                <div class="col-7">
                                    <span class="text-info">Functional Relationship</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="row">
                                <div class="col-5">
                                    <img style="width:100%" src="assets/images/advisor.png">
                                </div>
                                <div class="col-7">
                                    <span class="text-info">Advisor</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-6">
                            <div class="row">
                                <div class="col-5">
                                    <img style="width:100%" src="assets/images/directrel.png">
                                </div>
                                <div class="col-7">
                                    <span class="text-info">Direct Relationship</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<ng-template #sheetTemplate let-modal>
<!--     <div class="modal-header" style="  background-color: #ffffff;">
        <h4 class="modal-title" id="modal-basic-title" style="color: #45d9d9">
            <span *ngIf="!sheetToEdit.ID">Add Sheet to Project: {{projectSelected.ProjectName}}</span>
            <span *ngIf="sheetToEdit.ID">Edit Sheet on Project: {{projectSelected.ProjectName}}</span>
        </h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')" style="   outline: none;color: #ffffff">
            <span aria-hidden="true">&times;</span>
        </button>
    </div> -->
    <div class="modal-body" style="position: relative;">

        <i (click)="modal.dismiss('Cross click')" style=" font-size: 18px;background-color: #ffffff;border-radius: 45%;position: absolute;top:-5;right: -5;color: #999999;cursor: pointer;" class="bi bi-x-circle"></i>

        <div class="col-12" style="background:#ffffff;padding:  0px; ">
            <form  style="margin: 0px;">
<!--                 <label><b style="font-size: 1em">Sheet</b></label>
                <hr style="margin-top: 0px"> -->
                <div class="form-group row" style="margin: 0px;">
<!--             <label for="SheetName" class="col-4 col-form-label" style="padding-right:5px;">Sheet Name</label> -->
                    <div class="col-11"style="padding:  0px;">
                        <input type="text" class="form-control" id="SheetName" name="SheetName" placeholder="Sheet Name" #SheetName="ngModel" [(ngModel)]="sheetToEdit.SheetName" required>
                    </div>
                    <div class="col-1"    style="padding:  0px;">
                            <button class="btn" style="float: left;" (click)="saveSheet(sheetToEdit,true);modal.dismiss('Cross click')">
                                <i style=" font-size: 28px;" class="bi bi-check2-circle"></i>
                            </button>
                    </div>

                   <!--  <div class="col-12">
                        <div style="float: right" *ngIf="SheetName.invalid && (SheetName.dirty || SheetName.touched)">
                            <div *ngIf="SheetName.errors.required">
                                <p class="text-danger">*Sheet Name is required</p>
                            </div>
                        </div>
                    </div> -->
                </div>
            </form>
        </div>
<!--         <div class="modal-footer">
            <button class="btn btn-danger" (click)="modal.dismiss('Cross click')" style="float: left;">Close</button>
            <button class="btn btn-success" style="float: right;" (click)="saveSheet(sheetToEdit);modal.dismiss('Cross click')">Save</button>
        </div> -->
    </div>
</ng-template>
<ng-template #projectTemplate let-modal>
<!--     <div class="modal-header" style="  background-color: #ffffff;">
        <h4 class="modal-title" id="modal-basic-title" style="color: #45d9d9">
            <span *ngIf="!projectToEdit.ID">New</span><span *ngIf="projectToEdit.ID">Edit</span> Project
        </h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')" style="   outline: none;color: #ffffff">
            <span aria-hidden="true">&times;</span>
        </button>
    </div> -->
    <div class="modal-body" style="position: relative;">
<!--         <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')"
         style=" outline: none;color: #777777;position: absolute;top:-10;right: -5">
            <span aria-hidden="true">&times;</span>
        </button> -->
<!--         <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')"
         style=" outline: none;color: #777777; position: absolute;top:-5;right: -5">
                <i style=" font-size: 18px;background-color: #ffffff;border-radius: 45%" class="bi bi-x-circle"></i>
        </button>         -->
                <i (click)="modal.dismiss('Cross click')" style=" font-size: 18px;background-color: #ffffff;border-radius: 45%;position: absolute;top:-5;right: -5;color: #999999;cursor: pointer;" class="bi bi-x-circle"></i>



        <div class="col-12" style="background:#ffffff;padding:  0px; ">
            <form  style="margin: 0px;">
 <!--                <label><b style="font-size: 1em">Project</b></label>
                <hr style="margin-top: 0px"> -->
                <div class="form-group row" style="margin: 0px;">
                    <!--                     <label for="ProjectName" class="col-4 col-form-label" style="padding-right:5px;">Project Name</label> -->
                    <div class="col-11" style="padding:  0px;">
                        <input type="text" class="form-control" id="ProjectName" name="ProjectName" placeholder="Project Name" #ProjectName="ngModel" [(ngModel)]="projectToEdit.ProjectName" required>
                    </div>
                    <div class="col-1"    style="padding:  0px;">
                            <button class="btn" style="float: left;" (click)="saveProject(projectToEdit,true);modal.dismiss('Cross click')">
                                <i style=" font-size: 28px;" class="bi bi-check2-circle"></i>
                            </button>
                    </div>
<!--                         <div style="float: left;padding: 0px" *ngIf="ProjectName.invalid && (ProjectName.dirty || ProjectName.touched)">
                            <div *ngIf="ProjectName.errors.required" style="padding: 0px">
                                <p class="text-danger" style="padding: 0px">*Project Name is required</p>
                            </div>
                        </div> -->
                
 
                </div>
            </form>
        </div>
<!--         <div class="modal-footer">
            <button class="btn btn-danger" (click)="modal.dismiss('Cross click')" style="float: left;">Close</button>
            <button class="btn btn-success" style="float: right;" (click)="saveProject(projectToEdit);modal.dismiss('Cross click')">Save</button>
        </div> -->
    </div>
</ng-template>
<ng-template #addTreeNodeTemplate let-modal>
    <div class="modal-header" style="  background-color: #ffffff;">
        <h4 class="modal-title" id="modal-basic-title" style="color: #45d9d9">
            <span>New</span> Node
        </h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')" style="   outline: none;color: #ffffff">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="padding: 1px;">
        <div class="col-12" style="background:#ffffff ">
            <form style="height: 200px">
                <label><b style="font-size: 1em">Add <span class="text-info">{{nodeType}}</span> Node to ({{activeNode(tree)}})</b></label>
                <hr style="margin-top: 0px">
                <div class="form-group row">
                    <label for="nodeType" class="col-4 col-form-label" style="padding-right:5px;">Node Type</label>
                    <div class="col-8">
                        <select class="form-control" [(ngModel)]="nodeType" name="nodeType" (change)="setNodeNameDisplacement(nodeType)">
                            <option [ngValue]="'child'">Child</option>
                            <option [ngValue]="'sibling'">Sibling</option>
                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="nodeName" class="col-4 col-form-label" style="padding-right:5px;">Node Name</label>
                    <div class="col-8">
                        <input type="text" class="form-control" id="nodeName" name="nodeName" placeholder="Node Name" [(ngModel)]="nodeName" required>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-danger" (click)="modal.dismiss('Cross click')" style="float: left;">Close</button>
            <button *ngIf="nodeType=='child'" class="btn btn-success" style="float: right;" (click)="addNode(tree,nodeName,nodePositionCode);modal.dismiss('Cross click')">Create Child</button>
            <button *ngIf="nodeType=='sibling'" class="btn btn-success" style="float: right;" (click)="addNodeSibling(tree,nodeName,nodePositionCode);modal.dismiss('Cross click')">Create Sibling</button>
        </div>
    </div>
</ng-template>
<ng-template #searchSheetTemplate let-modal>
    <div class="modal-header" style="  background-color:#ffffff">
        <h4 class="modal-title" id="modal-basic-title" style="color: #45d9d9">
            <span>Select</span> Project Sheet
        </h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')" style="   outline: none;color: #ffffff">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="padding: 1px;">
        <div class="col-12" style="background:#ffffff ">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let sheet of projectSheets; index as i">
                        <td>{{ sheet.SheetName }}</td>
                        <td>
                            <button type="button" class="btn btn-outline-dark btn-sm" (click)="addSheetToView(sheet);modal.dismiss('Cross click')" ngbTooltip="Add Sheet to View">
                                <i class="bi bi-check2-all"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="modal-footer">
            <button class="btn btn-danger" (click)="modal.dismiss('Cross click')" style="float: left;">Close</button>
        </div>
    </div>
</ng-template>
<ng-template #rt let-r="result" let-t="term">
    <span style="border-bottom: 1px solid #eeeeee; padding-bottom: 5px">
        <img style="height: 20px;" class="rounded-circle mr-1" src="assets/images/nick.png">
        <ngb-highlight [result]="r.Name" [term]="t"></ngb-highlight>
    </span>
</ng-template>
<ng-template #rtcontacts let-r="result" let-t="term">
    <span style="border-bottom: 1px solid #eeeeee; padding-bottom: 5px">
        <img style="height: 20px;" class="rounded-circle mr-1" src="assets/images/nick.png">
        <ngb-highlight [result]="r.Name" [term]="t"></ngb-highlight>
    </span>
</ng-template>
<ng-template #configDefaultShapeTemplate let-modal>
    <div class="modal-header" style="  background-color: #ffffff;">
        <h4 class="modal-title" id="modal-basic-title" style="color: #45d9d9">
            Shape settings <span style="color:#ee9f06"></span>
        </h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')" style="outline: none;color: #ffffff">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="padding: 1px;">
        <div class="col-12" style="background:#ffffff;min-height:300px; ">
            <ul ngbNav #nav2="ngbNav" [(activeId)]="active3" class="nav-pills">
                <li [ngbNavItem]="1">
                    <a ngbNavLink><span class="tab-title">Shape</span></a>
                    <ng-template ngbNavContent>
                        <form>
                            <div class="row">
                                <div class="col-3">
                                    <label for="nodeType" class="col-4 col-form-label" style="padding-right:5px;">Fill</label>
                                    <label class="form-control radio-shapes" for="customRadio">
                                        <input type="radio" [value]="'none'" [(ngModel)]="paperView.shapeProperties.fill.type" id="customRadio1" name="paperView.shapeProperties.fill.type" (change)="paperView.resetFillColor()">
                                        No fill
                                    </label>
                                    <label class="form-control radio-shapes" for="customRadio">
                                        <input type="radio" [value]="'solid'" [(ngModel)]="paperView.shapeProperties.fill.type" id="customRadio2" name="paperView.shapeProperties.fill.type">
                                        Solid fill
                                    </label>
                                    <div class="col-12">
                                        <span style="float: left;margin-right: 20px;margin-right:#45d9d9;width: 60%" class="radio-shapes">Color/Opacity</span>
                                        <input style="width: 20%" name="paperView.shapeProperties.fill.color" [cpOutputFormat]="'rgba'" [(colorPicker)]="paperView.shapeProperties.fill.color" [style.background]="paperView.shapeProperties.fill.color" [cpOKButton]="true" [cpSaveClickOutside]="false" [cpOKButtonClass]="'btn btn-primary btn-xs'" />
                                    </div>
                                </div>
                                <div class="col-5">
                                    <label for="nodeType" class="col-4 col-form-label" style="padding-left:0px;">Text Box</label>
                                    <div class="form-group row">
                                        <label for="nodeType" class="col-6 col-form-label radio-shapes" style="padding-right:5px;">Verticall Alignment</label>
                                        <div class="col-6">
                                            <select class="form-control" [(ngModel)]="paperView.shapeProperties.textBox.verticalAlligment" name="textBox.verticalAlligment">
                                                <option [ngValue]="'top'">Top</option>
                                                <option [ngValue]="'middle'">Middle</option>
                                                <option [ngValue]="'bottom'">Bottom</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="nodeType" class="col-6 col-form-label  radio-shapes" style="padding-right:5px;">Text Direction</label>
                                        <div class="col-6">
                                            <select class="form-control" [(ngModel)]="paperView.shapeProperties.textBox.textDirection" name="textBox.textDirection">
                                                <option [ngValue]="'horizontal'">Horizontal</option>
                                                <option [ngValue]="'vertical'">Vertical</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="nodeType" class="col-12 col-form-label radio-shapes" style="padding-right:5px;">Shape Size</label>
                                        <div class="row">
                                            <div class="col-12">
                                                <label style="display: inline;width: 80px;margin-right: 5px;" class="form-control col-6 radio-shapes" for="paperView.shapeProperties.width">Width</label>
                                                <input style="display: inline;width: 70px" class="form-control col-6" min="0" type="number" [(ngModel)]="paperView.shapeProperties.width" name="paperView.shapeProperties.width">
                                            </div>
                                            <div class="col-12">
                                                <label style="display: inline;width: 50%" class="form-control col-6 radio-shapes" for="paperView.shapeProperties.height">Height</label>
                                                <input style="display: inline;width: 70px" class="form-control col-6" min="0" type="number" [(ngModel)]="paperView.shapeProperties.height" name="paperView.shapeProperties.height">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <label for="nodeType" class="col-4 col-form-label" style="padding-left:0px;">Line</label>
                                    <div class="form-group row">
                                        <label class="form-control radio-shapes" for="customRadio21">
                                            <input type="radio" [value]="'none'" [(ngModel)]="paperView.shapeProperties.line.type" id="customRadio10" name="line.type">
                                            No line
                                        </label>
                                        <label class="form-control radio-shapes" for="customRadio22">
                                            <input type="radio" [value]="'solid'" [(ngModel)]="paperView.shapeProperties.line.type" id="customRadio11" name="line.type">
                                            Solid line
                                        </label>
                                    </div>
                                    <div class="col-12" style="padding-left: 0px;">
                                        <span style="float: left;margin-right: 20px;margin-right:#45d9d9" class="radio-shapes">Color/Opacity</span>
                                        <input style="width: 20%" name="paperView.shapeProperties.line.color" [cpOutputFormat]="'rgba'" [(colorPicker)]="paperView.shapeProperties.line.color" [style.background]="paperView.shapeProperties.line.color" [cpOKButton]="true" [cpSaveClickOutside]="false" [cpOKButtonClass]="'btn btn-primary btn-xs'" />
                                    </div>
                                    <div class="form-row mt-2">
                                        <label class="form-control radio-shapes col-4" for="paperView.shapeProperties.line.width">
                                            Width
                                        </label>
                                        <input class="form-control col-8" type="number" min="0" [(ngModel)]="paperView.shapeProperties.line.width" name="paperView.shapeProperties.line.width">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </ng-template>
                </li>
                <li [ngbNavItem]="2">
                    <a ngbNavLink><span class="tab-title">Privacy</span></a>
                    <ng-template ngbNavContent>
                        <!---->
                        <div class="row">
                            <div class="col-12" style="min-height: 140px">
                                <div class="row">
                                    <div class="col-12">
                                        <form style="margin-bottom: 0px;height: 15px;">
                                            <label class="form-control" for="enableAditional" style="border:none">
                                                <input type="checkbox" name="enableAditional" [(ngModel)]="paperView.shapeProperties.privacy.enableAditional">
                                                <small style="margin-left: 10px;">Aditional</small>
                                            </label>
                                        </form>
                                    </div>
                                    <div class="col-12">
                                        <app-select-contact *ngIf="paperView.shapeProperties.privacy.enableAditional" #selectContactComp (contactsAdded)="addAditionalShape($event)"></app-select-contact>
                                    </div>
                                </div>
                                <table class="table table-sm" *ngIf="paperView.shapeProperties.privacy.enableAditional" style="margin-bottom: 0px;">
                                    <tbody>
                                        <tr>
                                            <th> </th>
                                            <th> <small>Name</small> </th>
                                            <th> <small>See</small> </th>
                                            <th> <small>Modify</small> </th>
                                            <th> <small>Delete</small> </th>
                                        </tr>
                                        <tr *ngFor="let contact of paperView.shapeProperties.privacy.contactsAditional">
                                            <td>
                                                <button class="btn" (click)="deleteAditionalShape(contact,tree)">
                                                    <i class="bi bi-x-circle"></i>
                                                </button>
                                            </td>
                                            <td> {{contact.name}} </td>
                                            <td class="pt-2"><input (change)="updateAditionalShape(contact)" type="checkbox" name="{{contact.see}}" [(ngModel)]="contact.see">
                                            </td>
                                            <td class="pt-2"><input (change)="updateAditionalShape(contact)" type="checkbox" name="{{contact.modify}}" [(ngModel)]="contact.modify">
                                            </td>
                                            <td class="pt-2"> <input (change)="updateAditionalShape(contact)" type="checkbox" name="{{contact.delete}}" [(ngModel)]="contact.delete"> </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="col-12" style="min-height: 140px">
                                <div class="row">
                                    <div class="col-12">
                                        <form style="margin-bottom: 0px;height: 15px;">
                                            <label class="form-control" for="enableException" style="border:none">
                                                <input type="checkbox" name="enableException" [(ngModel)]="paperView.shapeProperties.privacy.enableException">
                                                <small style="margin-left: 10px;">Exception</small>
                                            </label>
                                        </form>
                                    </div>
                                    <div class="col-12">
                                        <app-select-contact *ngIf="paperView.shapeProperties.privacy.enableException" #selectContactComp (contactsAdded)="addExceptionShape($event)"></app-select-contact>
                                    </div>
                                </div>
                                <table *ngIf="paperView.shapeProperties.privacy.enableException" class="table table-sm" style="margin-bottom: 0px;">
                                    <tbody>
                                        <tr>
                                            <th></th>
                                            <th> <small>Name</small> </th>
                                            <th> <small>See</small> </th>
                                            <th> <small>Modify</small> </th>
                                            <th> <small>Delete</small> </th>
                                        </tr>
                                        <tr *ngFor="let contact of paperView.shapeProperties.privacy.contactsException">
                                            <td> <button class="btn" (click)="deleteExceptionShape(contact,tree)">
                                                    <i class="bi bi-x-circle"></i>
                                                </button>
                                            </td>
                                            <td> {{contact.name}} </td>
                                            <td class="pt-2"><input (change)="updateExceptionShape(contact)" type="checkbox" name="{{contact.see}}" [(ngModel)]="contact.see"> </td>
                                            <td class="pt-2"><input (change)="updateExceptionShape(contact)" type="checkbox" name="{{contact.modify}}" [(ngModel)]="contact.modify"></td>
                                            <td class="pt-2"> <input (change)="updateExceptionShape(contact)" type="checkbox" name="{{contact.delete}}" [(ngModel)]="contact.delete"> </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!---->
                        <!--                         <div class="row">

                            <div class="col">
 
                                <form>
                                    <label class="form-control" for="enableAditional" style="border:none">
                                        <input type="checkbox" name="enableAditional" [(ngModel)]="paperView.shapeProperties.privacy.enableAditional">
                                        Aditional
                                    </label>
                                    <input *ngIf="paperView.shapeProperties.privacy.enableAditional" class="form-control" type="text" name="enableAditionalSearch" placeholder="Search" [ngbTypeahead]="searchContacts" [resultTemplate]="rt" (selectItem)="selectAditional($event)" [inputFormatter]="formatter">
                                </form>
                                <table class="table table-sm" *ngIf="paperView.shapeProperties.privacy.enableAditional">
                                    <tbody>
                                        <tr>
                                            <th> </th>
                                            <th> Name </th>
                                            <th> See </th>
                                            <th> Modify </th>
                                            <th> Delete </th>
                                        </tr>
                                        <tr *ngFor="let contact of paperView.shapeProperties.privacy.contactsAditional">
                                            <td>
                                                <button class="btn" (click)="deleteAditional(contact)">
                                                    <i class="bi bi-x-circle"></i>
                                                </button>
                                            </td>
                                            <td> {{contact.name}} </td>
                                            <td class="pt-2"><input (change)="updateAditional(contact)" type="checkbox" name="{{contact.see}}" [(ngModel)]="contact.see">
                                            </td>
                                            <td class="pt-2"><input (change)="updateAditional(contact)" type="checkbox" name="{{contact.modify}}" [(ngModel)]="contact.modify">
                                            </td>
                                            <td class="pt-2"> <input (change)="updateAditional(contact)" type="checkbox" name="{{contact.delete}}" [(ngModel)]="contact.delete"> </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="col">
                                <form>
                                    <label class="form-control" for="enableException" style="border:none">
                                        <input type="checkbox" name="enableException" [(ngModel)]="paperView.shapeProperties.privacy.enableException">
                                        Exception
                                    </label>
                                    <input *ngIf="paperView.shapeProperties.privacy.enableException" class="form-control" type="text" name="enableExceptionSearch" placeholder="Search" [ngbTypeahead]="searchContacts" [resultTemplate]="rt" (selectItem)="selectException($event)" [inputFormatter]="formatter">
                                </form>
                                <table *ngIf="paperView.shapeProperties.privacy.enableException" class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <th></th>
                                            <th> Name </th>
                                            <th> See </th>
                                            <th> Modify </th>
                                            <th> Delete </th>
                                        </tr>
                                        <tr *ngFor="let contact of paperView.shapeProperties.privacy.contactsException">
                                            <td> <button class="btn" (click)="deleteException(contact)">
                                                    <i class="bi bi-x-circle"></i>
                                                </button>
                                            </td>
                                            <td> {{contact.name}} </td>
                                            <td class="pt-2"><input type="checkbox" name="{{contact.see}}" [(ngModel)]="contact.see"> </td>
                                            <td class="pt-2"><input type="checkbox" name="{{contact.modify}}" [(ngModel)]="contact.modify"></td>
                                            <td class="pt-2"> <input type="checkbox" name="{{contact.delete}}" [(ngModel)]="contact.delete"> </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div> -->
                    </ng-template>
                </li>
            </ul>
            <div [ngbNavOutlet]="nav2" class="mt-2"></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-danger" (click)="modal.dismiss('Cross click')" style="float: left;">Close</button>
            <button class="btn btn-success" (click)="saveActiveSheetShapesDefaults();modal.dismiss('Cross click')" style="float: right;">Save</button>
        </div>
    </div>
</ng-template>
<ng-template #confirmDeleteAnyTemplate let-modal>
    <div class="modal-header" style="  background-color: rgba(69,217,217,0.5);">
        <span style="margin-left: auto;margin-right: auto">
            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="#45d9d9" class="bi bi-exclamation-triangle" viewBox="0 0 16 16">
                <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z" />
                <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995z" />
            </svg>
        </span>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')" style="   outline: none;color: #ffffff;position: absolute;top: 20px;right: 20px">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="padding: 1px;">
        <div class="col-12" style="background:#ffffff ">
            <h6 class="modal-title" id="modal-basic-title" style="color: #777777;padding: 20px">
                <span>Would you like to delete {{confirmDeleteAnyMsg}}?</span>
            </h6>
        </div>
        <div class="col-12" style="background:#ffffff ">
        </div>
        <div class="modal-footer" style="    justify-content: center;">
            <button class="btn btn-success" (click)=" deleteAny();modal.dismiss('Cross click')">Accept</button>
            <button class="btn btn-danger" (click)="modal.dismiss('Cross click')">Cancel</button>
        </div>
    </div>
</ng-template>


<ng-template #confirmDeleteTreeNodeTemplate let-modal>
    <div class="modal-header" style="  background-color: rgba(69,217,217,0.5);">
        <span style="margin-left: auto;margin-right: auto">
            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="#45d9d9" class="bi bi-exclamation-triangle" viewBox="0 0 16 16">
                <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z" />
                <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995z" />
            </svg>
        </span>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')" style="   outline: none;color: #ffffff;position: absolute;top: 20px;right: 20px">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="padding: 1px;">
        <div class="col-12" style="background:#ffffff ">
            <h6 class="modal-title" id="modal-basic-title" style="color: #777777">
                <span>Would you like to delete {{nodeToDeleteData.node.data.name}} and bellow relationships on all sheets?</span>
            </h6>
        </div>
        <div class="col-12" style="background:#ffffff ">
        </div>
        <div class="modal-footer" style="    justify-content: center;">
            <button class="btn btn-success" (click)=" deleteNode(tree);modal.dismiss('Cross click')">Accept</button>
            <button class="btn btn-danger" (click)="modal.dismiss('Cross click')">Cancel</button>
        </div>
    </div>
</ng-template>
<ng-template #confirmActionTemplate let-modal>
    <div class="modal-header" style="  background-color: rgba(69,217,217,0.5);">
        <span style="margin-left: auto;margin-right: auto">
            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="#45d9d9" class="bi bi-exclamation-triangle" viewBox="0 0 16 16">
                <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z" />
                <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995z" />
            </svg>
        </span>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')" style="   outline: none;color: #ffffff;position: absolute;top: 20px;right: 20px">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="padding: 1px;">
        <div class="col-12" style="background:#ffffff ">
            <h6 class="modal-title" id="modal-basic-title" style="color: #777777">
                <span>Would you like to ?</span>
            </h6>
        </div>
        <div class="col-12" style="background:#ffffff ">
        </div>
        <div class="modal-footer" style="text-align: center;">
            <button class="btn btn-success" (click)=" deleteNode(tree);modal.dismiss('Cross click')">Yes</button>
            <button class="btn btn-danger" (click)="modal.dismiss('Cross click')">No</button>
        </div>
    </div>
</ng-template>
<ng-template #uploadTemplate let-modal>
    <div class="modal-header" style="  background-color: #ffffff;">
        <h4 class="modal-title" id="modal-basic-title" style="color: #45d9d9">
            Add Attachment
        </h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')" style="outline: none;color: #ffffff">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="padding: 20px;">
        <form>
            <div class="form-group row">
                <div class="col-4">
                    <div class="form-group">
                        <input type="file" id="file" (change)="handleFileInput($event.target.files)">
                    </div>
                </div>
                <div class="col-sm-9">
                    <button class="btn btn-success btn-block" (click)="postFile('',fileToUpload,tree)">Upload</button>
                </div>
            </div>
        </form>
    </div>
</ng-template>
<ng-template #funcionalRelTemplate let-modal>
    <div class="modal-header" style="  background-color: #ffffff;">
        <h4 class="modal-title" id="modal-basic-title" style="color: #45d9d9">
            Functional Relationship
        </h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')" style="outline: none;color: #ffffff">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="padding: 20px;height: 250px">
        <tree-root #treeModal [nodes]="nodes" (focus)="onNodeSelectFunctionRel($event,treeModal,modal)" [options]="options"></tree-root>
    </div>
</ng-template>
<ng-template #setImendiateSuperiorTemplate let-modal>
    <div class="modal-header" style="  background-color: #ffffff;">
        <h4 class="modal-title" id="modal-basic-title" style="color: #45d9d9">
            Select Position
        </h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')" style="outline: none;color: #ffffff">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="padding: 20px;height: 250px">
        <tree-root #treeModal [nodes]="nodes" (focus)="onNodeSelectSetImendiateSuperior($event,treeModal,modal)" [options]="options"></tree-root>
    </div>
</ng-template>
<ng-template #reportsWindowTemplate let-modal>
    <div class="modal-header" style="  background-color: #ffffff;">
        <h4 class="modal-title" id="modal-basic-title" style="color: #45d9d9">
            Reports
        </h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')" style="outline: none;color: #ffffff">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="padding: 20px;height: 250px">
    </div>
    <div class="modal-footer" style="text-align: center;">
        <button class="btn btn-danger" (click)="modal.dismiss('Cross click')">Close</button>
    </div>
</ng-template>
<ng-template #translateAllTemplate let-modal>
    <div class="modal-header" style="  background-color: #ffffff;">
        <h4 class="modal-title" id="modal-basic-title" style="color: #45d9d9">
            Move all Elements (pixels)
        </h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')" style="outline: none;color: #ffffff">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="padding: 20px;height: 250px;position: relative;">
        <button style="font-size: 60px;position: absolute;left:110px;top:30px" type="button" class="btn btn-sm btn-outline-dark" (click)="translateAll('up',moveunits.value)">
            <i class="bi bi-chevron-up"></i>
        </button>
        <button style="font-size: 60px;position: absolute;left:60;top:80px" type="button" class="btn btn-sm btn-outline-dark" (click)="translateAll('left',moveunits.value)">
            <i class="bi bi-chevron-left"></i>
        </button>
        <input id="moveunits" #moveunits style="height: 30px; position: absolute;width: 55px;left:121px;top:100px;z-index: 1000000; padding: 0px; font-size: 20px;" class="form-control" type="number" placeholder="" value="200" />
        <button style="font-size: 60px;position: absolute;right:60px;top:80px" type="button" class="btn btn-sm btn-outline-dark" (click)="translateAll('right',moveunits.value)">
            <i class="bi bi-chevron-right"></i>
        </button>
        <button style="font-size: 60px;position: absolute;left:110px;top:130px" type="button" class="btn btn-sm btn-outline-dark" (click)="translateAll('down',moveunits.value)">
            <i class="bi bi-chevron-down"></i>
        </button>
    </div>
    <div class="modal-footer" style="text-align: center;">
        <button class="btn btn-success" (click)="modal.dismiss('Cross click')">Accept</button>
        <button class="btn btn-danger" (click)="modal.dismiss('Cross click')">Close</button>
    </div>
</ng-template>